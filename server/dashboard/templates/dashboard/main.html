{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard PA vs SV - {{ tenant.name|default:"Sistema" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        .kpi-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            min-height: 300px;
        }

        .loading-overlay {
            background: rgba(255, 255, 255, 0.8);
        }

        .tab-active {
            border-bottom: 3px solid #3B82F6;
            color: #3B82F6;
            font-weight: 600;
        }

        .filter-select {
            min-width: 150px;
        }

        .table-fixed-header thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 9999px;
        }

        .estado-SOBRECARGA {
            background: #FEE2E2;
            color: #DC2626;
        }

        .estado-FALTA {
            background: #FEF3C7;
            color: #D97706;
        }

        .estado-EXACTO {
            background: #D1FAE5;
            color: #059669;
        }

        .estado-NO_PLANIFICADO {
            background: #E5E7EB;
            color: #6B7280;
        }

        .estado-SIN_PERSONAL {
            background: #DBEAFE;
            color: #2563EB;
        }

        .estado-SIN_DATOS {
            background: #F3F4F6;
            color: #9CA3AF;
        }

        /* CRITICAL TABLE HEADER OVERRIDES - MAXIMUM SPECIFICITY */
        html body table thead th,
        html body table thead tr th,
        html body .table-fixed-header thead th,
        html body .table-fixed-header thead tr th,
        html body .min-w-full thead th,
        html body .min-w-full thead tr th {
            color: #f3f7ff !important;
            background-color: #0a0f1f !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.16) !important;
            letter-spacing: 0.08em !important;
            padding: 1rem 0.75rem !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            font-size: 0.85rem !important;
        }

        /* Force right and center alignment overrides */
        html body table thead th.text-right,
        html body table thead th.text-center {
            text-align: right !important;
            color: #f3f7ff !important;
            background-color: #0a0f1f !important;
        }

        html body table thead th.text-center {
            text-align: center !important;
        }

        /* Override ALL Tailwind table header classes */
        html body th[class*="text-gray"],
        html body th[class*="bg-"],
        html body thead[class*="bg-"],
        html body .bg-gray-50 {
            color: #f3f7ff !important;
            background-color: #0a0f1f !important;
        }

        /* Table header hover effects */
        html body table thead th:hover,
        html body .table-fixed-header thead th:hover {
            background-color: rgba(255, 44, 85, 0.2) !important;
            color: #f3f7ff !important;
        }

        /* Sortable headers */
        html body table th[data-sort]:hover {
            background-color: rgba(255, 44, 85, 0.25) !important;
            cursor: pointer;
        }

        /* Table container styling */
        html body .table-fixed-header thead {
            backdrop-filter: blur(10px) !important;
            -webkit-backdrop-filter: blur(10px) !important;
            background: linear-gradient(120deg, rgba(255, 44, 85, 0.25), rgba(0, 247, 255, 0.12)) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.16) !important;
        }
    </style>
    <link rel="stylesheet" href="{% static 'dashboard/main.css' %}?v=20241231">
</head>

<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-700 to-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <img src="{% static 'dashboard/Logo.jpeg' %}" alt="Liderman" class="h-16 bg-white p-1 rounded">
                    <div>
                        <h1 class="text-xl font-bold">Dashboard PA vs SV</h1>
                        <p class="text-blue-200 text-xs">Análisis de Personal Asignado vs Servicio Vivo</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 flex-wrap">
                    <div class="flex items-center gap-2">
                        <label class="text-sm text-white-100">Periodo:</label>
                        <select id="period-select"
                            class="text-gray-800 px-3 py-1.5 rounded border-0 text-sm focus:ring-2 focus:ring-blue-300">
                            <option value="">Cargando...</option>
                        </select>
                    </div>
                    <button id="compare-btn"
                        class="bg-white/20 text-white px-3 py-1.5 rounded text-sm hover:bg-white/30 transition">
                        📊 Comparar
                    </button>
                    <a href="{% url 'dashboard:upload' %}"
                        class="bg-green-500 text-white px-3 py-1.5 rounded text-sm hover:bg-green-600 transition">
                        📤 Subir
                    </a>
                    <a href="{% url 'jobs:job_latest_download' %}?tenant=default"
                        class="bg-orange-500 text-white px-3 py-1.5 rounded text-sm hover:bg-orange-600 transition">
                        📥 Excel
                    </a>
                    <div class="h-8 w-px bg-blue-500/50 mx-1"></div>
                    <div class="flex items-center gap-3">
                        <div class="text-right text-xs hidden sm:block">
                            <p class="font-medium text-blue-50">{{ user.username }}</p>
                            <p class="text-blue-200">{{ permissions.role_display }}</p>
                        </div>
                        <form id="logout-form" action="{% url 'dashboard:logout' %}" method="post" class="hidden">
                            {% csrf_token %}
                        </form>
                        <a href="#" onclick="document.getElementById('logout-form').submit(); return false;"
                            class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded text-sm transition">
                            Salir
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Filtros Globales -->
    <div class="bg-white border-b shadow-sm">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-wrap items-center gap-2 sm:gap-3">
                <span class="text-sm font-medium text-white-600">Filtros:</span>
                <select id="filter-macrozona"
                    class="filter-select text-xs sm:text-sm border rounded px-2 py-1 min-w-[120px] sm:min-w-[150px]">
                    <option value="">Macro Zona - Todas</option>
                </select>
                <select id="filter-zona" class="filter-select text-sm border rounded px-2 py-1">
                    <option value="">Zona - Todas</option>
                </select>
                <select id="filter-compania" class="filter-select text-sm border rounded px-2 py-1">
                    <option value="">Compañía - Todas</option>
                </select>
                <select id="filter-grupo" class="filter-select text-sm border rounded px-2 py-1">
                    <option value="">Grupo - Todos</option>
                </select>
                <select id="filter-sector" class="filter-select text-sm border rounded px-2 py-1">
                    <option value="">Sector - Todos</option>
                </select>
                <select id="filter-gerente" class="filter-select text-sm border rounded px-2 py-1">
                    <option value="">Gerente - Todos</option>
                </select>
                <button id="clear-filters" class="text-sm text-blue-600 hover:text-blue-800 ml-2">
                    🔄 Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4">
            <nav class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-1">
                <button
                    class="tab-btn tab-active px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center border-b-3 hover:text-blue-600"
                    data-tab="resumen">
                    📈 Resumen
                </button>
                <button
                    class="tab-btn px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center text-gray-600 hover:text-blue-600"
                    data-tab="clientes">
                    👥 Por Cliente
                </button>
                <button
                    class="tab-btn px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center text-gray-600 hover:text-blue-600"
                    data-tab="unidades">
                    🏢 Por Unidad
                </button>
                <button
                    class="tab-btn px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center text-gray-600 hover:text-blue-600"
                    data-tab="servicios">
                    🔧 Por Servicio
                </button>
                <button
                    class="tab-btn px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center text-gray-600 hover:text-blue-600"
                    data-tab="graficos">
                    📊 Gráficos
                </button>
                <button
                    class="tab-btn px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center text-gray-600 hover:text-blue-600"
                    data-tab="detalle">
                    📋 Detalle
                </button>
            </nav>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="hidden fixed inset-0 loading-overlay z-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-lg flex items-center gap-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <span class="text-gray-700">Cargando datos...</span>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- TAB: Resumen -->
        <div id="tab-resumen" class="tab-content">
            <!-- KPI Cards -->
            <section class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">Personal Asignado</p>
                    <p id="kpi-pa" class="text-2xl font-bold text-blue-600 mt-1">--</p>
                    <p class="text-xs text-gray-400">Suma PA</p>
                </div>
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">Servicio Vivo</p>
                    <p id="kpi-sv" class="text-2xl font-bold text-green-600 mt-1">--</p>
                    <p class="text-xs text-gray-400">Suma SV Estimado</p>
                </div>
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">Diferencia</p>
                    <p id="kpi-diff" class="text-2xl font-bold text-orange-600 mt-1">--</p>
                    <p class="text-xs text-gray-400">PA - SV</p>
                </div>
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">Cobertura</p>
                    <p id="kpi-coverage" class="text-2xl font-bold text-purple-600 mt-1">--%</p>
                    <p class="text-xs text-gray-400">PA/SV × 100</p>
                </div>
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">% Diferencial</p>
                    <p id="kpi-diff-pct" class="text-2xl font-bold text-teal-600 mt-1">--%</p>
                    <p class="text-xs text-gray-400">Diff/SV × 100</p>
                </div>
                <div class="kpi-card bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-xs font-medium">Total Servicios</p>
                    <p id="kpi-servicios" class="text-2xl font-bold text-indigo-600 mt-1">--</p>
                    <p class="text-xs text-gray-400">Registros únicos</p>
                </div>
            </section>

            <!-- Charts Row 1 -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">📊 Distribución por Estado</h3>
                    <div id="chart-estado" class="chart-container"></div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">🏆 Top 10 Clientes</h3>
                    <div id="chart-clientes" class="chart-container"></div>
                </div>
            </section>

            <!-- Charts Row 2 -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">🌍 Personal por Zona</h3>
                    <div id="chart-zona" class="chart-container"></div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">🗺️ Por MacroZona</h3>
                    <div id="chart-macrozona" class="chart-container"></div>
                </div>
            </section>
        </div>

        <!-- TAB: Por Cliente -->
        <div id="tab-clientes" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 class="font-semibold text-gray-800">👥 Análisis por Cliente</h3>
                    <input type="text" id="search-cliente" placeholder="Buscar cliente..."
                        class="px-3 py-1.5 border rounded text-sm w-64">
                </div>
                <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                    <table class="min-w-full table-fixed-header">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre del
                                    Cliente</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre del
                                    Grupo</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Real</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Estimado</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Diferencia
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Cobertura
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">%
                                    Diferencial</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Estado
                                </th>
                            </tr>
                        </thead>
                        <tbody id="table-clientes" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="8" class="px-4 py-8 text-center text-gray-500">Cargando...</td>
                            </tr>
                        </tbody>
                        <tfoot class="font-semibold">
                            <tr id="totals-clientes">
                                <td class="px-4 py-3 text-sm">Total</td>
                                <td class="px-4 py-3"></td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pa-cli">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-sv-cli">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-diff-cli">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-cob-cli">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pct-cli">--</td>
                                <td class="px-4 py-3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <!-- Pagination -->
                <div class="p-4 border-t flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        <span id="page-start-clientes">0</span> - <span id="page-end-clientes">0</span> de <span
                            id="total-records-clientes">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="prev-page-clientes"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50" disabled>←
                            Anterior</button>
                        <span id="page-info-clientes" class="text-sm px-2">1</span>
                        <button id="next-page-clientes"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50">Siguiente
                            →</button>
                    </div>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: Por Unidad -->
        <div id="tab-unidades" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 class="font-semibold text-gray-800">🏢 Análisis por Unidad</h3>
                    <input type="text" id="search-unidad" placeholder="Buscar unidad..."
                        class="px-3 py-1.5 border rounded text-sm w-64">
                </div>
                <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                    <table class="min-w-full table-fixed-header">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre de la
                                    Unidad</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Real</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Estimado</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Diferencia
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Cobertura
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">%
                                    Diferencial</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Estado
                                </th>
                            </tr>
                        </thead>
                        <tbody id="table-unidades" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="px-4 py-8 text-center text-gray-500">Cargando...</td>
                            </tr>
                        </tbody>
                        <tfoot class="font-semibold">
                            <tr id="totals-unidades">
                                <td class="px-4 py-3 text-sm">Total</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pa-uni">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-sv-uni">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-diff-uni">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-cob-uni">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pct-uni">--</td>
                                <td class="px-4 py-3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <!-- Pagination -->
                <div class="p-4 border-t flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        <span id="page-start-unidades">0</span> - <span id="page-end-unidades">0</span> de <span
                            id="total-records-unidades">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="prev-page-unidades"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50" disabled>←
                            Anterior</button>
                        <span id="page-info-unidades" class="text-sm px-2">1</span>
                        <button id="next-page-unidades"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50">Siguiente
                            →</button>
                    </div>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: Por Servicio -->
        <div id="tab-servicios" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 class="font-semibold text-gray-800">🔧 Análisis por Servicio</h3>
                    <input type="text" id="search-servicio" placeholder="Buscar servicio..."
                        class="px-3 py-1.5 border rounded text-sm w-64">
                </div>
                <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                    <table class="min-w-full table-fixed-header">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre del
                                    Servicio</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Real</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Personal
                                    Estimado</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Diferencia
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Cobertura
                                </th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">%
                                    Diferencial</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Estado
                                </th>
                            </tr>
                        </thead>
                        <tbody id="table-servicios" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="px-4 py-8 text-center text-gray-500">Cargando...</td>
                            </tr>
                        </tbody>
                        <tfoot class="font-semibold">
                            <tr id="totals-servicios">
                                <td class="px-4 py-3 text-sm">Total</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pa-srv">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-sv-srv">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-diff-srv">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-cob-srv">--</td>
                                <td class="px-4 py-3 text-right text-sm" id="total-pct-srv">--</td>
                                <td class="px-4 py-3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <!-- Pagination -->
                <div class="p-4 border-t flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        <span id="page-start-servicios">0</span> - <span id="page-end-servicios">0</span> de <span
                            id="total-records-servicios">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="prev-page-servicios"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50" disabled>←
                            Anterior</button>
                        <span id="page-info-servicios" class="text-sm px-2">1</span>
                        <button id="next-page-servicios"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50">Siguiente
                            →</button>
                    </div>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: Gráficos -->
        <div id="tab-graficos" class="tab-content hidden">
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">🍩 PA vs SV (Donut)</h3>
                    <div id="chart-donut" class="chart-container"></div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">📈 Por Grupo</h3>
                    <div id="chart-grupo" class="chart-container"></div>
                </div>
            </section>
            <section class="grid grid-cols-1 gap-4">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-sm font-semibold text-white-700 mb-3">📊 Comparativa PA vs SV por Unidad (Top 10)
                    </h3>
                    <div id="chart-unidades-bar" class="chart-container" style="height: 400px;"></div>
                </div>
            </section>
        </div>

        <!-- TAB: Detalle Completo -->
        <div id="tab-detalle" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center flex-wrap gap-3">
                    <h3 class="font-semibold text-gray-800">📋 Detalle Completo de Servicios</h3>
                    <div class="flex items-center gap-3">
                        <input type="text" id="search-input" placeholder="Buscar..."
                            class="px-3 py-1.5 border rounded text-sm w-64">
                        <button id="export-btn"
                            class="bg-green-600 text-white px-3 py-1.5 rounded text-sm hover:bg-green-700">
                            📥 Exportar
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Cliente_Final">Cliente</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Unidad_Str">Unidad</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Servicio_Limpio">Servicio</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Personal_Real">PA</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Personal_Estimado">SV</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Diferencia">Diff</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
                                    data-sort="Estado">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-gray-200 text-sm">
                            <tr>
                                <td colspan="7" class="px-3 py-8 text-center text-gray-500">Cargando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination -->
                <div class="p-4 border-t flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        <span id="page-start">0</span> - <span id="page-end">0</span> de <span
                            id="total-records">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="prev-page"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50" disabled>←
                            Anterior</button>
                        <span id="page-info" class="text-sm px-2">1</span>
                        <button id="next-page"
                            class="px-3 py-1 border rounded text-sm hover:bg-gray-50 disabled:opacity-50">Siguiente
                            →</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Compare Modal -->
    <div id="compare-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">📊 Comparar Periodos</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">✕</button>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Periodo Actual</label>
                    <select id="compare-period1" class="w-full px-3 py-2 border rounded"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Periodo Anterior</label>
                    <select id="compare-period2" class="w-full px-3 py-2 border rounded"></select>
                </div>
            </div>
            <button id="run-compare"
                class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Comparar</button>
            <div id="compare-results" class="mt-4 hidden">
                <h4 class="font-semibold text-gray-700 mb-2">Resultados</h4>
                <div id="compare-table" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuración dinámica para JavaScript
        window.DashboardConfig = {
            // Eliminar el último componente para obtener la raíz del dashboard (ej: /dashboard/)
            apiRoot: "{% url 'dashboard:main' %}"
        };
    </script>
    <script src="{% static 'dashboard/main.js' %}"></script>
</body>

</html>